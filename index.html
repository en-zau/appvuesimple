<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
		<title>Transport Nantes metropole</title>
		<style>

			h1 {
				text-align: center;
				margin: 10px;
			}

			h2	{
				margin: 10px;
			}
			.bar {
                background-color: #0dd85b;

                background-image: -webkit-linear-gradient(
                    top,
                    #0dd85b,
                    #0dd85b
                );
                background-image: -moz-linear-gradient(top, #0dd85b, #0dd85b);
                background-image: linear-gradient(top, #0dd85b, #0dd85b);

                box-shadow: 0 1px 1px #ccc;
                border-radius: 2px;
                width: 600px;
                padding: 14px;
                margin: 45px auto 20px;
                position: relative;
            }
			.bar input {
                background: #fff no-repeat 13px 13px;
                background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkU5NEY0RTlFMTA4NzExRTM5RTEzQkFBQzMyRjkyQzVBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkU5NEY0RTlGMTA4NzExRTM5RTEzQkFBQzMyRjkyQzVBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RTk0RjRFOUMxMDg3MTFFMzlFMTNCQUFDMzJGOTJDNUEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RTk0RjRFOUQxMDg3MTFFMzlFMTNCQUFDMzJGOTJDNUEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4DjA/RAAABK0lEQVR42pTSQUdEURjG8dOY0TqmPkGmRcqYD9CmzZAWJRHVRIa0iFYtM6uofYaiEW2SRJtEi9YxIklp07ZkWswu0v/wnByve7vm5ee8M+85zz1jbt9Os+WiGkYdYxjCOx5wgFeXUHmtBSzpcCGa+5BJTCjEP+0nKWAT8xqe4ArPGEEVC1hHEbs2oBwdXkM7mj/JLZrad437sCGHOfUtcziutuYu2v8XUFF/4f6vMK/YgAH1HxkBYV60AR31gxkBYd6xAeF3VzMCwvzOBpypX8V4yuFRzX2d2gD/l5yjH4fYQEnzkj4fae5rJulF2sMXVrAsaTWttRFu4Osb+1jEDT71/ZveyhouTch2fINQL9hKefKjuYFfuznXWzXMTabyrvfyIV3M4vhXgAEAUMs7K0J9UJAAAAAASUVORK5CYII=);

                border: none;
                width: 100%;
                line-height: 19px;
                padding: 11px 0;

                border-radius: 2px;
                box-shadow: 0 2px 8px #c4c4c4 inset;
                text-align: left;
                font-size: 14px;
                font-family: inherit;
                color: #738289;
                font-weight: bold;
                outline: none;
                text-indent: 40px;
            }
			.radio {
				display: flex;
    			padding: 14px 100px;
    			justify-content: space-around;
				box-shadow: 0 1px 1px #ccc;
                border-radius: 2px;
                width: 600px;
                margin: 45px auto 20px;
                position: relative;
			}
		</style>
	</head>
	<body>
		<form id="demo">
			
		<div id="demo">
			<h1>Carte des transports</h1>
			<img style="margin-left: 250px;" src="https://presse.com/wp-content/uploads/16866/Plan-du-reseau-des-transports-en-commun-de-Nantes-2022-1024x962.jpg" class="img-fluid" alt="...">


			<h2>Les differents {{currenttype === 'all' ? 'transports' : currenttype}} :</h2>

			<div class="bar">
				<input type="search" v-model="searchString" placeholder="Enter your number bus">
			</div>
			<div class="radio">
				<template v-for="type in types">
						<div class="radio-input">
							<input
							type="radio"
							:id="type"
							:value="type"
							name="type"
							v-model="currenttype"
						/>
						<label style="margin-left: 5px;" :for="type">{{ type }}</label>
					</div>
				</template>
			</div>
			
			<div class="row row-cols-1 row-cols-md-3 g-4">
				<div v-for="record in searchbus">
					<div class="col">
						<div class="card" style="width: 18rem;">
							<div class="card-body">
								<h5 class="card-title">{{record.fields.route_short_name}}</h5>
								<h6 class="card-subtitle mb-2 text-muted">{{record.fields.route_type}}</h6>
								<p class="card-text">dessert les arrets de {{record.fields.route_long_name}}</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script src="https://unpkg.com/vue@3"></script>
		<script>
			const apiURL =
				"https://data.nantesmetropole.fr/api/records/1.0/search/?dataset=244400404_tan-circuits&q=&rows=107&facet=route_long_name&facet=route_type";
			const config = {
			};

			Vue.createApp({	
				data() {
					return {
						donnes: null,
                        types: ["all","Bus", "Tram", "Ferry"],
                        currenttype : "all",
						searchString : "",
					};
				},

				created: function () {
					this.fetchDataPromise();
					// this.fetchDataAsync()
				},

				watch: {
					currenttype: "fetchDataPromise", //fetchDataAsync
				},
				methods: {
					fetchDataPromise: function () {
						const self = this;
						axios
							.get(apiURL)
							.then(function (response) {
								console.log(response.data);
								self.donnes = response.data.records;
								// console.log(self.commits[0].html_url);
							})
							.catch(function (error) {
								console.log(error);
							});
					},

                
				},
				computed: {
					
					searchbus: function () {
                        let array = this.donnes,
						currenttype = this.currenttype,
                        searchString = this.searchString;
                        if (searchString) {
                            searchString = searchString.trim().toLowerCase();

							array = array.filter(function (item) {
								if (
									item.fields.route_short_name
										.toLowerCase()
										.startsWith(searchString) === true
								) {
									return item;
								}
                        	});
                        }
						console.log(currenttype !== 'all')

                        
						if (currenttype !== 'all') {
							array = array.filter(function (item) {
                            if (
                                item.fields.route_type
                                    === currenttype
                            ) {
                                return item;
                            }
                        });
						}
						
                        return array;
                    },
				}
			}).mount("#demo");
		</script>
	</body>
</html>